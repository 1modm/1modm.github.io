<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" class="no-js">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      PHP - Using Native Password Hashing API &middot; Heiswayi Nrird on Tech
    
  </title>

  
    <meta name="description" content="As of PHP 5.5, password hashing made easy!"/>
    <meta name="keywords" content="php 5.5, password hashing, native api">
  
  <meta name="author" content="Heiswayi Nrird">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@HeiswayiNrird">
  <meta name="twitter:creator" content="@HeiswayiNrird">
  
    <meta name="twitter:title" content="PHP - Using Native Password Hashing API">
    <meta name="twitter:description" content="As of PHP 5.5, password hashing made easy!">
  

  <meta property="og:type" content="website"/>
  
    <meta property="og:title" content="PHP - Using Native Password Hashing API"/>
    <meta property="og:url" content="/php-using-native-password-hashing-api.html"/>
    <meta property="og:description" content="As of PHP 5.5, password hashing made easy!"/>
    <meta property="og:site_name" content="PHP - Using Native Password Hashing API"/>
  

  <link rel="apple-touch-icon" sizes="57x57" href="/public/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/public/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/public/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/public/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/public/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/public/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/public/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/public/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/icons/favicon-16x16.png">
  <link rel="manifest" href="/public/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#f3f3f3">
  <meta name="msapplication-TileImage" content="/public/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="google-site-verification" content="aSavCGGU0uSN5HEHnI7ZiMqVKxn7mfUPCGMVJvmDQ1w" />
  <meta name="wot-verification" content="6da2597a332a1fadad8f"/>

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/public/css/normalize.css">
  <link rel="stylesheet" href="/public/css/style.css">

  <script src="/public/js/modernizr.custom.js"></script>
  <script src="/public/js/jquery-1.11.2.min.js"></script>
  <script src="/public/js/masonry.pkgd.min.js"></script>

  <!--[if lt IE 9]>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.1.0/respond.min.js"></script>
    <script src="/public/js/rem.min.js"></script>
  <![endif]-->
</head>


  <body>

    <div class="wrap">
      <div class="master-nav">
        <div class="nav">
            <ul class="top-menu">
              <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
              <li><a href="/about.html"><i class="fa fa-info-circle"></i> About</a></li>
              <li><a href="/notes.html"><i class="fa fa-pencil"></i> Notes</a></li>
              <li><a class="resume" href="http://heiswayi.github.io/resume/"><i class="fa fa-file-text-o"></i> Resume</a></li>
              <li><a class="special" href="http://heiswayi.github.io/my-repos/"><i class="fa fa-github-alt"></i> Repositories</a></li>
              <li><a class="special" href="http://heiswayi.github.io/my-gists/"><i class="fa fa-code"></i> Gists</a></li>
              <li><a class="unique" href="http://heiswayi.nrird.com"><i class="fa fa-camera-retro"></i> Photography</a></li>
            </ul>
        </div>
      </div>

      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="/" title="Home">Heiswayi Nrird on Tech</a>
            <small>Another Software Guy's Blog</small>
          </h2>

          <div class="footer-social-links">
  <a href="http://heiswayi.nrird.com/atom.xml" title="RSS Feed" target="_blank"><i class="fa fa-rss"></i></a>
  <a href="https://my.linkedin.com/in/nrird" title="LinkedIn" target="_blank"><i class="fa fa-linkedin"></i></a>
  <a href="https://www.facebook.com/profile.php?id=1257583160" title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>
  <a href="https://twitter.com/HeiswayiNrird" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a>
  <a href="https://github.com/heiswayi" title="GitHub" target="_blank"><i class="fa fa-github-alt"></i></a>
  <a href="https://gist.github.com/heiswayi" title="GitHub Gist" target="_blank"><i class="fa fa-code"></i></a>
  <a href="http://codepen.io/heiswayi/" title="CodePen" target="_blank"><i class="fa fa-codepen"></i></a>
  <a href="https://500px.com/heiswayi_nrird" title="500px" target="_blank"><i class="fa fa-500px"></i></a>
  <a href="https://instagram.com/heiswayi.nrird/" title="Instagram" target="_blank"><i class="fa fa-instagram"></i></a>
</div>


        </div>
      </div>

      <div class="container content">
        <div class="post">
  <div class="post-top-meta">
    <div class="post-date">October 01, 2015 &middot; <span class="reading-time" title="Estimated Reading Time">
  
  
    8 minutes read
  
</span>
</div>
    <h1 class="post-title">PHP - Using Native Password Hashing API</h1>
  </div>

  <div class="hrline"></div>

  <h2 id="introduction">Introduction</h2>

<p>Password hashing is one of the most basic security considerations that must be made when designing any application that accepts passwords from users. Without hashing, any passwords that are stored in your application’s database can be stolen if the database is compromised, and then immediately used to compromise not only your application, but also the accounts of your users on other services, if they do not use unique passwords.</p>

<p>This can be done by applying a hashing algorithm to your user’s passwords before storing them in your database, so you make it implausible for any attacker to determine the original password. Hashing algorithms such as MD5, SHA1 and SHA256 are designed to be very fast and efficient. However, with modern techniques and computer equipment, it has become trivial to “brute force” the output of these algorithms in order to determine the original input. This is why <code class="highlighter-rouge">md5()</code> and <code class="highlighter-rouge">sha1()</code> are not suitable for password hashing functions.</p>

<p>Luckily, as of PHP 5.5, a <strong>native password hashing API</strong> was introduced to safely handle both hashing and verifying passwords in a secure manner. When hashing passwords, the two most important considerations are the computational expense, and the salt. The more computationally expensive the hashing algorithm, the longer it will take to brute force its output. So, the suggested algorithm to use when hashing passwords is Blowfish, which is also the default used by this password hashing API.</p>

<h2 id="the-implementation-of-api">The Implementation of API</h2>

<p>The implementation consists of 4 functions:-</p>

<ul>
  <li><code class="highlighter-rouge">password_hash()</code> : To create a new password hash</li>
  <li><code class="highlighter-rouge">password_verify()</code> : To confirm a given password matches with the hash</li>
  <li><code class="highlighter-rouge">password_needs_rehash()</code> : To check if a password meets the desired hash settings (algorithm, cost)</li>
  <li><code class="highlighter-rouge">password_get_info()</code> : To return information about the hash such as algorithm and cost</li>
</ul>

<blockquote>
  <p><strong>password_hash()</strong> creates a new password hash using a strong one-way hashing algorithm and compatible with <a href="http://php.net/manual/en/function.crypt.php"><strong>crypt()</strong></a>.</p>
</blockquote>

<h2 id="usage-examples">Usage Examples</h2>

<h3 id="example-1">Example 1</h3>

<p><code class="highlighter-rouge">password_hash()</code> example with <strong>PASSWORD_DEFAULT</strong></p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * We just want to hash our password using the current DEFAULT algorithm.
 * This is presently BCRYPT, and will produce a 60 character result.
 *
 * Beware that DEFAULT may change over time, so you would want to prepare
 * By allowing your storage to expand past 60 characters (255 would be good)
 */</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$2y$10$kZ8eWlGS30qABEthikt.uOvdYETzS3azGCutmfOdtXMzEvFuNoMWe
</code></pre>
</div>

<h3 id="example-2">Example 2</h3>

<p><code class="highlighter-rouge">password_hash()</code> example with setting <strong>cost</strong> manually</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * In this case, we want to increase the default cost for BCRYPT to 12.
 * Note that we also switched to BCRYPT, which will always be 60 characters.
 */</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">12</span><span class="p">,</span>
<span class="p">];</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$2y$12$gsF2.s.PkKLusBMsgHrQnOmB5mzG0bHGE97.SA5250aQ0ZTt0Klty
</code></pre>
</div>

<blockquote>
  <p>The role of the cost is to ensure that the passwords remain difficult to brute force even as hardware gets faster. You will need to continuously tweak your cost as your own hardware changes. However, if you are not careful and just crank it up to 11 (figuritively speaking) your passwords will take too long to generate, tying up web server threads and can easily lead to a DoS attack.</p>
</blockquote>

<p>Here’s the code to benchmark your server in order <strong>to determine how high of a cost you can afford</strong>:</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$timeTarget</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span> <span class="c1">// 50 milliseconds
</span>
<span class="nv">$cost</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="nv">$cost</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">$start</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"test"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="p">[</span><span class="s2">"cost"</span> <span class="o">=&gt;</span> <span class="nv">$cost</span><span class="p">]);</span>
    <span class="nv">$end</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="nv">$end</span> <span class="o">-</span> <span class="nv">$start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nv">$timeTarget</span><span class="p">);</span>

<span class="k">echo</span> <span class="s2">"Appropriate Cost Found: "</span> <span class="o">.</span> <span class="nv">$cost</span> <span class="o">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Appropriate Cost Found: 10
</code></pre>
</div>

<p>This is good if you want to set the highest cost that you can without slowing down your server too much. <strong>8 - 10 is a good baseline</strong>, and is good if your servers are fast enough. The code above aims for less than 50ms stretching time, which is a good baseline for systems handling interactive logins.</p>

<h3 id="example-3">Example 3</h3>

<p><code class="highlighter-rouge">password_hash()</code> example with setting <strong>salt</strong> manually</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="sd">/**
 * Note that the salt here is randomly generated.
 * Never use a static salt or one that is not randomly generated.
 *
 * For the VAST majority of use-cases, let password_hash generate the salt randomly for you
 */</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s1">'salt'</span> <span class="o">=&gt;</span> <span class="nb">mcrypt_create_iv</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="nx">MCRYPT_DEV_URANDOM</span><span class="p">),</span>
<span class="p">];</span>
<span class="k">echo</span> <span class="nb">password_hash</span><span class="p">(</span><span class="s2">"KittenDies"</span><span class="p">,</span> <span class="nx">PASSWORD_BCRYPT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">)</span><span class="o">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO
</code></pre>
</div>

<blockquote>
  <p><strong>CAUTION:</strong> It is strongly recommended that you do not generate your own salt for this function. It will create a secure salt automatically for you if you do not specify one.</p>
</blockquote>

<h3 id="example-4">Example 4</h3>

<p><code class="highlighter-rouge">password_verify()</code> example</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO'</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="s1">'KittenDies'</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'Password is valid!'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'Invalid password.'</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Password is valid!
</code></pre>
</div>

<blockquote>
  <p>If you get incorrect false responses from <strong>password_verify()</strong> when manually including the hash variable (eg. for testing) and you know it should be correct, make sure you are enclosing the hash variable in single quotes (‘) and not double quotes (“).</p>
</blockquote>

<h3 id="example-5">Example 5</h3>

<p><code class="highlighter-rouge">password_needs_rehash()</code> example</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$password</span> <span class="o">=</span> <span class="s1">'rasmuslerdorf'</span><span class="p">;</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$10$YCFsG6elYca568hBi2pZ0.3LDL5wjgxct1N8w/oLR/jfHsiQwCqTS'</span><span class="p">;</span>

<span class="c1">// The cost parameter can change over time as hardware improves
</span><span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'cost'</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">);</span>

<span class="c1">// Verify stored hash against plain-text password
</span><span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Check if a newer hashing algorithm is available
</span>    <span class="c1">// or the cost has changed
</span>    <span class="k">if</span> <span class="p">(</span><span class="nb">password_needs_rehash</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If so, create a new hash, and replace the old one
</span>        <span class="nv">$newHash</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Log user in
</span><span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre>
</div>

<h3 id="example-6">Example 6</h3>

<p><code class="highlighter-rouge">password_get_info()</code> example</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">'$2y$11$dtSMAuO41g5QZcAG76FqTehpk35Dcf0lkEpBffEW7dRqQsrR2E8VO'</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">password_get_info</span><span class="p">(</span><span class="nv">$hash</span><span class="p">));</span>

<span class="cp">?&gt;</span>
</code></pre>
</div>

<p>Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>array (size=3)
  'algo' =&gt; int 1
  'algoName' =&gt; string 'bcrypt' (length=6)
  'options' =&gt;
    array (size=1)
      'cost' =&gt; int 11
</code></pre>
</div>

<h2 id="compatibility">Compatibility</h2>

<p>If you are not using PHP 5.5, there is a <a href="https://github.com/ircmaxell/password_compat">pure PHP compatibility library</a> available for PHP 5.3.7 and later.</p>

<h2 id="salt">Salt</h2>

<p>A cryptographic salt is a data which is applied during the hashing process in order to eliminate the possibility of the output being looked up in a list of pre-calculated pairs of hashes and their input, known as a rainbow table.</p>

<p><code class="highlighter-rouge">password_hash()</code> will create a random salt if one is not provided, and this is generally the easiest and the most secure approach.</p>

<h2 id="storing-the-salt">Storing the Salt</h2>

<p>When using <code class="highlighter-rouge">password_hash()</code> or <code class="highlighter-rouge">crypt()</code>, the return value includes the salt as part of the generated hash. This value should be stored verbatim in your database, as it includes information about the hash function that was used and can then be given directly to <code class="highlighter-rouge">password_verify()</code> or <code class="highlighter-rouge">crypt()</code> when verifying passwords.</p>

<p><img src="http://i.imgur.com/9cmcBRo.png" alt="Password Hash" /></p>

<p>The diagram above shows the format of a return value from <code class="highlighter-rouge">crypt()</code> or <code class="highlighter-rouge">password_hash()</code>. As you can see, they are self-contained, with all the information on the algorithm and salt required for future password verification.</p>

<h2 id="conclusion">Conclusion</h2>

<p>With this new <a href="http://php.net/password">password extension</a>, the password hashing becomes more easier as we don’t need to create our custom-made algorithm class or use any other external password hashing class library in our application anymore.</p>

  
</div>
<div class="back"><a href="/notes.html"><i class="fa fa-chevron-left"></i> Back</a></div>

      </div>
    </div>

	  <div class="footer">
	<div class="hrline"></div>
	<div class="license">Unless otherwise stated, all original code presented on this site is licensed under the <a href="http://heiswayi.github.io/mit-license">MIT license</a>. All original photographs and text on this website are licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives</a> license. If you have any questions about using any of this material for commercial purposes, please <a href="https://github.com/heiswayi/ama">ask me here</a> or <a href="mailto:asd@gmail.com">write an email to me</a>.</div>
	<div class="copyright">Made with <span style="color:#e00"><i class="fa fa-heart"></i></span> using <a href="http://jekyllrb.com">Jekyll</a> &middot; <i class="fa fa-code"></i> on <a href="https://github.com/heiswayi/heiswayi.github.io_jekyll_source">GitHub</a> <i class="fa fa-github-alt"></i><br>&copy; 2016 Heiswayi Nrird</div>
</div>

<script>
$(window).load(function() {
	$('.grid').masonry({
		itemSelector: '.grid-item',
		columnWidth: '.grid-sizer',
		gutter: 10
	});
});
</script>


	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-58296043-7', 'auto');
  ga('send', 'pageview');
</script>




  </body>
</html>
